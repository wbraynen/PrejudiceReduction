<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spatialized Prisoner's Dilemma (NetLogo-matched)</title>
  <style>
    :root{
      --panel-bg:#efefef;
      --panel-border:#c9c9c9;
      --text:#222;
    }

    body{
      margin:0;
      padding:16px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:var(--text);
      background:#ffffff;
    }

    .app{
      max-width: 1180px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: 260px 1fr 320px;
      gap:16px;
      align-items:start;
    }

    .panel{
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      border-radius: 6px;
      padding: 12px;
    }

    .panel h2{
      font-size: 14px;
      margin: 0 0 10px 0;
      font-weight: 700;
    }

    label{
      font-size: 12px;
      font-weight: 600;
      line-height: 1.2;
    }

    input[type="range"], select{
      width: 100%;
    }

    .slider-row{
      display:grid;
      grid-template-columns: 1fr 56px;
      align-items:center;
      gap:10px;
      margin: 10px 0;
    }

    .value-pill{
      display:inline-block;
      text-align:right;
      font-variant-numeric: tabular-nums;
      font-size: 12px;
      padding: 6px 8px;
      background: #fff;
      border: 1px solid var(--panel-border);
      border-radius: 6px;
      min-width: 56px;
      box-sizing:border-box;
    }

    .buttonbar{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top: 8px;
    }

    button{
      padding: 8px 10px;
      border: 1px solid #888;
      background: #fff;
      border-radius: 6px;
      cursor:pointer;
      font-weight: 700;
      font-size: 12px;
      text-transform: none;
    }
    button:active{ transform: translateY(1px); }

    .world{
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .world-title{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:12px;
    }
    .world-title h1{
      font-size: 16px;
      margin: 0;
      font-weight: 800;
    }
    .world-title .ticks{
      font-size: 12px;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
    }

    .canvas-wrap{
      background:#fff;
      border: 1px solid var(--panel-border);
      border-radius: 6px;
      padding: 10px;
    }

    /* Keep logical canvas at grid size; scale visually like NetLogo patches */
    #worldCanvas{
      width: 448px;  /* 64 * 7 */
      height: 448px;
      display:block;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      background:#fff;
      border: 1px solid #ddd;
    }

    .mini-table{
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      background:#fff;
      border: 1px solid var(--panel-border);
      border-radius: 6px;
      overflow:hidden;
    }
    .mini-table th, .mini-table td{
      padding: 6px 8px;
      border-bottom: 1px solid #eee;
      text-align:left;
      font-variant-numeric: tabular-nums;
    }
    .mini-table th{
      background:#f7f7f7;
      font-weight: 800;
    }
    .mini-table tr:last-child td{ border-bottom:none; }

    .swatch{
      width: 12px;
      height: 12px;
      border: 1px solid #999;
      display:inline-block;
      vertical-align: -2px;
      margin-right: 6px;
    }

    .note{
      font-size: 12px;
      line-height: 1.35;
      color:#333;
      margin-top: 10px;
    }

    @media (max-width: 1050px){
      .app{ grid-template-columns: 1fr; }
      #worldCanvas{
        width: min(90vw, 448px);
        height: min(90vw, 448px);
      }
    }
  </style>
</head>
<body>
  <div class="app">

    <!-- Left controls (NetLogo-like button column) -->
    <div class="panel">
      <h2>Controls</h2>

      <div class="buttonbar">
        <button id="resetBtn" title="NetLogo: setup">setup</button>
        <button id="startBtn" title="NetLogo: go">go</button>
        <button id="pauseBtn" title="Pause">pause</button>
      </div>

      <div class="buttonbar">
        <button id="toggleDisplayBtn" title="NetLogo: toggle display">toggle display</button>
        <button id="desegregateBtn" title="NetLogo: (de)segragate">(de)segragate</button>
      </div>

      <hr style="border:none;border-top:1px solid #ddd;margin:12px 0;">

      <div class="slider-row">
        <label for="speed">speed (ms)</label>
        <span class="value-pill" id="speedValue">100</span>
      </div>
      <input type="range" id="speed" min="50" max="1000" value="100" step="50" />

      <div class="note">
        Defaults match the NetLogo model: segregated ethnicities, showing strategies, rounds=200,
        imitation radius=1.5, payoffs (CC,CD,DC,DD) = (3,0,5,1).
      </div>
    </div>

    <!-- Center: world view (single canvas like NetLogo) -->
    <div class="world">
      <div class="world-title">
        <h1>Spatialized Prisoner's Dilemma</h1>
        <div class="ticks">ticks: <span id="ticks">0</span></div>
      </div>

      <div class="canvas-wrap">
        <canvas id="worldCanvas" width="64" height="64"></canvas>
      </div>

      <div class="panel">
        <h2>Behavior totals (NetLogo “Behavior” plot values)</h2>
        <table class="mini-table">
          <tr><th>moves</th><th>count</th></tr>
          <tr><td>C (cooperate)</td><td id="total_cooperated">0</td></tr>
          <tr><td>D (defect)</td><td id="total_defected">0</td></tr>
        </table>
      </div>
    </div>

    <!-- Right controls (NetLogo-like sliders + strategy counts) -->
    <div class="panel">
      <h2>Parameters</h2>

      <div class="slider-row">
        <label for="payoffs_cc">payoffs_cc</label>
        <span class="value-pill" id="payoffs_cc_value">3</span>
      </div>
      <input type="range" id="payoffs_cc" min="0" max="10" step="1" value="3" />

      <div class="slider-row">
        <label for="payoffs_cd">payoffs_cd</label>
        <span class="value-pill" id="payoffs_cd_value">0</span>
      </div>
      <input type="range" id="payoffs_cd" min="0" max="10" step="1" value="0" />

      <div class="slider-row">
        <label for="payoffs_dc">payoffs_dc</label>
        <span class="value-pill" id="payoffs_dc_value">5</span>
      </div>
      <input type="range" id="payoffs_dc" min="0" max="10" step="1" value="5" />

      <div class="slider-row">
        <label for="payoffs_dd">payoffs_dd</label>
        <span class="value-pill" id="payoffs_dd_value">1</span>
      </div>
      <input type="range" id="payoffs_dd" min="0" max="10" step="1" value="1" />

      <hr style="border:none;border-top:1px solid #ddd;margin:12px 0;">

      <div class="slider-row">
        <label for="rounds_to_play">rounds_to_play</label>
        <span class="value-pill" id="rounds_to_play_value">200</span>
      </div>
      <input type="range" id="rounds_to_play" min="4" max="200" step="4" value="200" />

      <div class="slider-row">
        <label for="imitation_radius">imitation_radius</label>
        <span class="value-pill" id="imitation_radius_value">1.5</span>
      </div>
      <input type="range" id="imitation_radius" min="1" max="3" step="0.5" value="1.5" />

      <hr style="border:none;border-top:1px solid #ddd;margin:12px 0;">

      <h2>Strategies (NetLogo “Strategies” plot counts)</h2>
      <table class="mini-table">
        <tr><th>strategy</th><th>count</th></tr>
        <tr><td><span class="swatch" style="background:#00C000"></span>000 AllD</td><td id="count_s0">0</td></tr>
        <tr><td><span class="swatch" style="background:#00FFFF"></span>001</td><td id="count_s1">0</td></tr>
        <tr><td><span class="swatch" style="background:#FF0000"></span>010 STFT</td><td id="count_s2">0</td></tr>
        <tr><td><span class="swatch" style="background:#FF00FF"></span>011</td><td id="count_s3">0</td></tr>
        <tr><td><span class="swatch" style="background:#FFFF00"></span>100</td><td id="count_s4">0</td></tr>
        <tr><td><span class="swatch" style="background:#4D4D4D"></span>101</td><td id="count_s5">0</td></tr>
        <tr><td><span class="swatch" style="background:#B3B3B3"></span>110 TFT</td><td id="count_s6">0</td></tr>
        <tr><td><span class="swatch" style="background:#0000FF"></span>111 AllC</td><td id="count_s7">0</td></tr>
        <tr><td><span class="swatch" style="background:#FFB366"></span>PTFT</td><td id="count_s8">0</td></tr>
      </table>

      <div class="note">
        Colors match the NetLogo <code>strategy-to-color</code> and <code>ethnicity-to-color</code>.
        Use <b>toggle display</b> to switch between strategies and ethnicities.
      </div>
    </div>

  </div>

  <script>
    // Keep slider value pills in sync (pure UI)
    const bind = (id) => {
      const el = document.getElementById(id);
      const out = document.getElementById(id + "_value");
      if (!el || !out) return;
      const update = () => out.textContent = el.value;
      el.addEventListener("input", update);
      update();
    };
    ["payoffs_cc","payoffs_cd","payoffs_dc","payoffs_dd","rounds_to_play","imitation_radius"].forEach(bind);

    const speed = document.getElementById("speed");
    const speedValue = document.getElementById("speedValue");
    if (speed && speedValue) {
      const update = () => speedValue.textContent = speed.value;
      speed.addEventListener("input", update);
      update();
    }
  </script>

  <!-- Your NetLogo-matched JS should target the element IDs in this HTML -->
  <script src="model.js" defer></script>
</body>
</html>